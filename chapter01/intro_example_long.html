
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Probably the simplest BIP in the world (the long story) &#8212; Uncertainty Quantification in Inverse Problems with CUQIpy</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"tex": {"macros": {"dd": "\\mathrm{d}", "abs": ["\\left\\vert#1\\right\\vert", 1], "ve": ["\\bm{#1}", 1], "mat": ["\\mathbf{#1}", 1], "N": "\\mathbb{N}", "floor": ["\\lfloor#1\\rfloor", 1], "bmat": ["\\left[\\begin{array}"], "emat": ["\\end{array}\\right]"], "bm": ["{\\boldsymbol #1}", 1]}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapter01/intro_example_long';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Chapter 2: Problem examples" href="../chapter02/chapter02.html" />
    <link rel="prev" title="Probably the simplest BIP in the world (the short story)" href="intro_example_short.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Uncertainty Quantification in Inverse Problems with CUQIpy - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Uncertainty Quantification in Inverse Problems with CUQIpy - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Uncertainty Quantification in Inverse Problems with CUQIpy
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="chapter01.html">Chapter 1: Introduction to CUQIpy</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview_of_cuqipy.html">Overview of CUQIpy</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_mini_book.html">Running the mini-book code examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_example_short.html">Probably the simplest BIP in the world (the short story)</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Probably the simplest BIP in the world (the long story)</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter02/chapter02.html">Chapter 2: Problem examples</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../chapter02/two_forward_problems.html">Two forward models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter02/two_target_distributions.html">Two target distributions</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter03/chapter03.html">Chapter 3: Basics of CUQIpy for solving BIPs</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../chapter03/basics_distributions.html">Introduction to distributions and basic sampling in CUQIpy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter03/basics_forward_models.html">Forward models, data generation and forward UQ</a></li>



<li class="toctree-l2"><a class="reference internal" href="../chapter03/basics_bayesian_inverse_problems.html">Bayesian Inverse Problems</a></li>






</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter04/chapter04.html">Chapter 4: Advanced use cases of CUQIpy</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../chapter04/gibbs.html">Gibbs sampling</a></li>




<li class="toctree-l2"><a class="reference internal" href="../chapter04/Plugins/CUQIpy-CIL/demo_ct.html">X-ray CT using CUQIpy and CUQIpy-CIL plugin</a></li>



<li class="toctree-l2"><a class="reference internal" href="../chapter04/PDE/core_pde.html">Solving PDE-based BIP using core CUQIpy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter04/Plugins/CUQIpy-FEniCS/poisson_2D_fenics.html">PDE-based BIP using CUQIpy and CUQIpy-FEniCS plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter04/Plugins/CUQIpy-PyTorch/hmc.html">Hamiltonian Monte Carlo with CUQIpy-PyTorch</a></li>




</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter05/chapter05.html">Chapter 5: More on CUQIpy technical details</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../chapter05/geometries_in_cuqipy.html">Geometry Objects: Representation, Parametrization, and Mapping</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter06/chapter06.html">Chapter 6: More theory on priors</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../chapter06/markov_random_fields.html">Markov random fields in CUQIpy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter06/entropy.html">Computing the entropy of a distribution, numerically</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter07/chapter07.html">Chapter 7: More theory on sampling</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../chapter07/more_theory_on_sampling_with_cuqipy.html">Sampling with CUQIpy: five little stories</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter08/chapter08.html">Chapter 8: More resources</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/CUQI-DTU/CUQI-Book/blob/master/chapter01/intro_example_long.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/chapter01/intro_example_long.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Probably the simplest BIP in the world (the long story)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#contents-of-this-notebook"><font color="#CD853F"> Contents of this notebook: </font></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-objectives"><font color="#CD853F"> Learning objectives: </font> <a name="r-learning-objectives"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-forward-model"><font color="#CD853F">The forward model </font> <a class="anchor" id="r-the-forward-model"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise"><font color="#8B4513">Exercise </font></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#elaboration-on-geometries"><font color="#8B4513">Elaboration on Geometries </font></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-prior"><font color="#CD853F">The prior </font> <a class="anchor" id="r-the-prior"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bayesian-approach-use-prior-to-express-belief-about-solution">Bayesian approach: Use prior to express belief about solution</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1"><font color="#8B4513">Exercise </font></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-noise-distribution"><font color="#CD853F"> The noise distribution </font> <a class="anchor" id="r-the-noise-distribution"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2"><font color="#8B4513">Exercise </font></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-data-distribution"><font color="#CD853F"> The data distribution </font> <a class="anchor" id="r-the-data-distribution"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3"><font color="#8B4513">Exercise </font></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-likelihood-function"><font color="#CD853F"> The likelihood function </font> <a class="anchor" id="r-the-likelihood-function"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#maximum-likelihood-ml-point-estimate"><font color="#CD853F"> Maximum likelihood (ML) point estimate </font> <a class="anchor" id="r-maximum-likelihood-ml-point-estimate"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-posterior-distribution"><font color="#CD853F"> The posterior distribution </font> <a class="anchor" id="r-posterior"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bayes-rule">Bayes’ rule</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#maximum-a-posteriori-map-estimate"><font color="#CD853F"> Maximum a posteriori (MAP) estimate </font> <a class="anchor" id="r-maximum-a-posteriori-map-estimate"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4"><font color="#8B4513">Exercise </font></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sampling-from-the-posterior"><font color="#CD853F"> Sampling from the posterior </font> <a class="anchor" id="r-sampling-from-the-posterior"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5"><font color="#8B4513">Exercise </font></a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="probably-the-simplest-bip-in-the-world-the-long-story">
<h1>Probably the simplest BIP in the world (the long story)<a class="headerlink" href="#probably-the-simplest-bip-in-the-world-the-long-story" title="Link to this heading">#</a></h1>
<section id="contents-of-this-notebook">
<h2><font color=#CD853F> Contents of this notebook: </font><a class="headerlink" href="#contents-of-this-notebook" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#r-learning-objectives"><span class="xref myst">Learning objectives</span></a></p></li>
<li><p><a class="reference internal" href="#r-the-forward-model"><span class="xref myst">The forward model</span></a></p></li>
<li><p><a class="reference internal" href="#r-the-prior"><span class="xref myst">The prior</span></a></p></li>
<li><p><a class="reference internal" href="#r-the-noise-distribution"><span class="xref myst">The noise distribution</span></a></p></li>
<li><p><a class="reference internal" href="#r-the-data-distribution"><span class="xref myst">The data distribution</span></a></p></li>
<li><p><a class="reference internal" href="#r-the-likelihood-function"><span class="xref myst">The likelihood function</span></a></p></li>
<li><p><a class="reference internal" href="#r-maximum-likelihood-ml-point-estimate"><span class="xref myst">Maximum likelihood (ML) point estimate</span></a></p></li>
<li><p><a class="reference internal" href="#r-posterior"><span class="xref myst">The posterior distribution</span></a></p></li>
<li><p><a class="reference internal" href="#r-maximum-a-posteriori-map-estimate"><span class="xref myst">Maximum a posteriori (MAP) estimate</span></a></p></li>
<li><p><a class="reference internal" href="#r-sampling-from-the-posterior"><span class="xref myst">Sampling from the posterior</span></a></p></li>
</ul>
</section>
<section id="learning-objectives">
<h2><font color=#CD853F> Learning objectives: </font> <a name="r-learning-objectives"></a><a class="headerlink" href="#learning-objectives" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Create a linear forward model object in CUQIpy and apply it to some parameters</p></li>
<li><p>Create a distribution object in CUQIpy that represents the prior and the noise, and sample, and visualize it</p></li>
<li><p>Create and design data distributions in CUQIpy for additive and multiplicative noise case and visualize it</p></li>
<li><p>Compute the MAP estimate in CUQIpy</p></li>
<li><p>Write the minimization problem that corresponds to finding the MAP estimate</p></li>
<li><p>Sample from the posterior distribution in CUQIpy and visualize the samples</p></li>
</ul>
</section>
<section id="the-forward-model">
<h2><font color=#CD853F>The forward model </font> <a class="anchor" id="r-the-forward-model"></a><a class="headerlink" href="#the-forward-model" title="Link to this heading">#</a></h2>
<p>Consider the following inverse problem: given observed data <span class="math notranslate nohighlight">\(b\)</span>, determine <span class="math notranslate nohighlight">\(x_1\)</span>, and <span class="math notranslate nohighlight">\(x_2\)</span>:</p>
<div class="math notranslate nohighlight">
\[b = x_1 + x_2 + e \;\;\mathrm{with}\;\; e \sim \mathrm{Gaussain}(0, 0.1)\]</div>
<p>We can write it as:</p>
<div class="math notranslate nohighlight">
\[b = \mathbf{A}\mathbf{x} + e = \large(1,1\large)\binom{x_1}{x_2} + e\]</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>variable</p></th>
<th class="head text-left"><p>description</p></th>
<th class="head text-left"><p>dimension</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p><span class="math notranslate nohighlight">\(\mathbf{x}\)</span></p></td>
<td class="text-left"><p>parameter to be inferred</p></td>
<td class="text-left"><p>2-dimensional​</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><span class="math notranslate nohighlight">\(\mathbf{A}\)</span></p></td>
<td class="text-left"><p>forward model</p></td>
<td class="text-left"><p>1-by-2 matrix</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p><span class="math notranslate nohighlight">\(b\)</span></p></td>
<td class="text-left"><p>data</p></td>
<td class="text-left"><p>1-dimensional</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p><span class="math notranslate nohighlight">\(e\)</span></p></td>
<td class="text-left"><p>noise</p></td>
<td class="text-left"><p>1-dimensional  ​</p></td>
</tr>
</tbody>
</table>
</div>
<p>This problem is:</p>
<ul class="simple">
<li><p>Considered a Linear inverse problem since the forward model is linear.</p></li>
<li><p>Ill-posed since the solution is not unique (Hadamard 2), i.e., for some given value of <span class="math notranslate nohighlight">\(b\)</span>, e.g., <span class="math notranslate nohighlight">\(b=3\)</span>, all points <span class="math notranslate nohighlight">\((x_1, x_2)\)</span> that satisfy <span class="math notranslate nohighlight">\(x_1 + x_1 = 3\)</span> are solutions to the (noise-free) problem.</p></li>
</ul>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importing the required libraries</span>
<span class="kn">from</span> <span class="nn">cuqi.distribution</span> <span class="kn">import</span> <span class="n">Gaussian</span>
<span class="kn">from</span> <span class="nn">cuqi.problem</span> <span class="kn">import</span> <span class="n">BayesianProblem</span>
<span class="kn">from</span> <span class="nn">cuqi.model</span> <span class="kn">import</span> <span class="n">LinearModel</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Let us define the forward model <span class="math notranslate nohighlight">\(\mathbf{A}\)</span>, we first define the matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">A_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<p>Verify the dimension of the forward model matrix <span class="math notranslate nohighlight">\(\mathbf{A}\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">A_matrix</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1, 2)
</pre></div>
</div>
</div>
</div>
<p>Now we wrap <code class="docutils literal notranslate"><span class="pre">A_matrix</span></code> in a <code class="docutils literal notranslate"><span class="pre">CUQIpy</span></code> forward model object as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">LinearModel</span><span class="p">(</span><span class="n">A_matrix</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let us test applying the forward model to some parameters:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">some_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="nd">@some_x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[3.]
</pre></div>
</div>
</div>
</div>
<section id="exercise">
<h3><font color=#8B4513>Exercise </font><a class="headerlink" href="#exercise" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Try applying <code class="docutils literal notranslate"><span class="pre">A</span></code> to a different input array</p></li>
<li><p>Create a new linear forward model <code class="docutils literal notranslate"><span class="pre">B</span></code> that represents the identity matrix of dimension 3 and apply it to some parameters</p></li>
<li><p>Print both of the models with <code class="docutils literal notranslate"><span class="pre">print(A)</span></code> and <code class="docutils literal notranslate"><span class="pre">print(B)</span></code>, what do you observe?</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">help(LinearModel)</span></code> to see the documentation of the class and the input arguments</p></li>
<li><p>Is this true for you: <strong>“I learned how to create a linear forward model object in CUQIpy and apply it to some parameters.”</strong>? If not, what questions do you have?</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># your code here</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="elaboration-on-geometries">
<h3><font color=#8B4513>Elaboration on Geometries </font><a class="headerlink" href="#elaboration-on-geometries" title="Link to this heading">#</a></h3>
<p>In CUQIpy, we have the concept of geometries to represent spaces of parameters and data, let us refer to both as variables.</p>
<ul class="simple">
<li><p>A <code class="docutils literal notranslate"><span class="pre">Geometry</span></code> object will define the dimension of the space of the variable.</p></li>
<li><p>It will define the interpretation of the variable values (e.g. values of function on a 1D or 2D grid, discrete values, coefficients in some expansion, image pixels, etc).</p></li>
<li><p>It is equipped with methods of plotting the variables.</p></li>
</ul>
<p>We notice that printing the forward model object <code class="docutils literal notranslate"><span class="pre">A</span></code>, for example, gives us</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CUQI</span> <span class="n">LinearModel</span><span class="p">:</span> <span class="n">_DefaultGeometry1D</span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span> <span class="o">-&gt;</span> <span class="n">_DefaultGeometry1D</span><span class="p">(</span><span class="mi">1</span><span class="p">,)</span><span class="o">.</span>
    <span class="n">Forward</span> <span class="n">parameters</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The first geometry <code class="docutils literal notranslate"><span class="pre">_DefaultGeometry1D(2,)</span></code> is the <code class="docutils literal notranslate"><span class="pre">domain_geometry</span></code> which represents the input space of the forward model, i.e., the space of the parameters <span class="math notranslate nohighlight">\(x_1\)</span> and <span class="math notranslate nohighlight">\(x_2\)</span>.</p></li>
<li><p>The second geometry <code class="docutils literal notranslate"><span class="pre">_DefaultGeometry1D(1,)</span></code> is the <code class="docutils literal notranslate"><span class="pre">range_geometry</span></code> which represents the output space of the forward model, i.e., the space of the data <span class="math notranslate nohighlight">\(b\)</span>.</p></li>
<li><p>The forward parameters <code class="docutils literal notranslate"><span class="pre">['x']</span></code> are the parameters that the forward model operates on, in this case, the parameters <span class="math notranslate nohighlight">\(x_1\)</span> and <span class="math notranslate nohighlight">\(x_2\)</span>.</p></li>
<li><p>You can access the domain and range geometries of the forward model object <code class="docutils literal notranslate"><span class="pre">A</span></code> by <code class="docutils literal notranslate"><span class="pre">A.domain_geometry</span></code> and <code class="docutils literal notranslate"><span class="pre">A.range_geometry</span></code> respectively.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">domain_geometry</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">range_geometry</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>_DefaultGeometry1D(2,)
_DefaultGeometry1D(1,)
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">_DefaultGeometry1D</span></code> is a simple geometry that is used as a default geometry in CUQIpy if the user does not specify a geometry.</p></li>
<li><p>We will revisit this concept at a later stage depending on forward models needs.</p></li>
</ul>
</section>
</section>
<section id="the-prior">
<h2><font color=#CD853F>The prior </font> <a class="anchor" id="r-the-prior"></a><a class="headerlink" href="#the-prior" title="Link to this heading">#</a></h2>
<section id="bayesian-approach-use-prior-to-express-belief-about-solution">
<h3>Bayesian approach: Use prior to express belief about solution<a class="headerlink" href="#bayesian-approach-use-prior-to-express-belief-about-solution" title="Link to this heading">#</a></h3>
<p>A common choice for simplicity is the zero mean Gaussian prior where the components are independent and identically distributed (i.i.d.):</p>
<div class="math notranslate nohighlight">
\[ \mathbf{x} \sim \mathrm{Gaussian}(\mathbf{0}, \delta^2 \mathbf{I})\]</div>
<p>The probability density function (PDF) of such a Gaussian prior is expressed as</p>
<div class="math notranslate nohighlight">
\[ \pi (\mathbf{x}) = \frac{1}{\sqrt{(2 \pi)^n \delta^{2n}}} \mathrm{exp}\left(-\frac{||\mathbf{x}||^2}{2\delta^2}\right) \]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(n\)</span> is the dimension of the parameter space (which is 2 in this specific case),</p></li>
<li><p><span class="math notranslate nohighlight">\(\delta\)</span> is the standard deviation of the prior distribution,</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{I}\)</span> is the identity matrix.</p></li>
</ul>
<p>Let us define the prior distribution for the parameters <span class="math notranslate nohighlight">\(x_1\)</span> and <span class="math notranslate nohighlight">\(x_2\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">Gaussian</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="mf">2.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot2d</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">x1_min</span><span class="p">,</span> <span class="n">x1_max</span><span class="p">,</span> <span class="n">x2_min</span><span class="p">,</span> <span class="n">x2_max</span><span class="p">,</span> <span class="n">N2</span><span class="o">=</span><span class="mi">201</span><span class="p">):</span>
    <span class="c1"># plot</span>
    <span class="n">pixelwidth_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x1_max</span><span class="o">-</span><span class="n">x1_min</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">N2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">pixelwidth_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2_max</span><span class="o">-</span><span class="n">x2_min</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">N2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">hp_x</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">pixelwidth_x</span>
    <span class="n">hp_y</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">pixelwidth_y</span>

    <span class="n">extent</span> <span class="o">=</span> <span class="p">(</span><span class="n">x1_min</span><span class="o">-</span><span class="n">hp_x</span><span class="p">,</span> <span class="n">x1_max</span><span class="o">+</span><span class="n">hp_x</span><span class="p">,</span> <span class="n">x2_min</span><span class="o">-</span><span class="n">hp_y</span><span class="p">,</span> <span class="n">x2_max</span><span class="o">+</span><span class="n">hp_y</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">plot_pdf_2D</span><span class="p">(</span><span class="n">distb</span><span class="p">,</span> <span class="n">x1_min</span><span class="p">,</span> <span class="n">x1_max</span><span class="p">,</span> <span class="n">x2_min</span><span class="p">,</span> <span class="n">x2_max</span><span class="p">,</span> <span class="n">N2</span><span class="o">=</span><span class="mi">201</span><span class="p">):</span>
    <span class="n">N2</span> <span class="o">=</span> <span class="mi">201</span>
    <span class="n">ls1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x1_min</span><span class="p">,</span> <span class="n">x1_max</span><span class="p">,</span> <span class="n">N2</span><span class="p">)</span>
    <span class="n">ls2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x2_min</span><span class="p">,</span> <span class="n">x2_max</span><span class="p">,</span> <span class="n">N2</span><span class="p">)</span>
    <span class="n">grid1</span><span class="p">,</span> <span class="n">grid2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">ls1</span><span class="p">,</span> <span class="n">ls2</span><span class="p">)</span>
    <span class="n">distb_pdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N2</span><span class="p">,</span><span class="n">N2</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N2</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N2</span><span class="p">):</span>
            <span class="n">distb_pdf</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">distb</span><span class="o">.</span><span class="n">logd</span><span class="p">([</span><span class="n">grid1</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">],</span> <span class="n">grid2</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">]]))</span> 
    <span class="n">plot2d</span><span class="p">(</span><span class="n">distb_pdf</span><span class="p">,</span> <span class="n">x1_min</span><span class="p">,</span> <span class="n">x1_max</span><span class="p">,</span> <span class="n">x2_min</span><span class="p">,</span> <span class="n">x2_max</span><span class="p">,</span> <span class="n">N2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>We can plot the prior PDF for the parameters <span class="math notranslate nohighlight">\(x_1\)</span> and <span class="math notranslate nohighlight">\(x_2\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_pdf_2D</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x1_min</span><span class="o">=-</span><span class="mi">5</span><span class="p">,</span> <span class="n">x1_max</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">x2_min</span><span class="o">=-</span><span class="mi">5</span><span class="p">,</span> <span class="n">x2_max</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_1809/403389231.py:23: DeprecationWarning: Conversion of an array with ndim &gt; 0 to a scalar is deprecated, and will error in future. Ensure you extract a single element from your array before performing this operation. (Deprecated NumPy 1.25.)
  distb_pdf[ii,jj] = np.exp(distb.logd([grid1[ii,jj], grid2[ii,jj]]))
</pre></div>
</div>
<img alt="../_images/9e1219b679aa359a53dbf7ca8a3ffb235796a9d4dcade20e21acf353c0894852.png" src="../_images/9e1219b679aa359a53dbf7ca8a3ffb235796a9d4dcade20e21acf353c0894852.png" />
</div>
</div>
<p>We can sample from the prior distribution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_samples</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can visualize the samples from the prior distribution, one way to do this is to plot samples pair plot:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_samples</span><span class="o">.</span><span class="n">plot_pair</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;v0&#39;, ylabel=&#39;v1&#39;&gt;
</pre></div>
</div>
<img alt="../_images/4377562ce71db3fec6bd7c395c499d22fa0234960abe0b0f2eeff431a7da70b7.png" src="../_images/4377562ce71db3fec6bd7c395c499d22fa0234960abe0b0f2eeff431a7da70b7.png" />
</div>
</div>
<section id="id1">
<h4><font color=#8B4513>Exercise </font><a class="headerlink" href="#id1" title="Link to this heading">#</a></h4>
<ol class="arabic">
<li><p>Can you generate one plot where you visualize the prior PDF and the pair plot together? (tip: after plotting the PDE, you can pass the <code class="docutils literal notranslate"><span class="pre">pyplot</span></code> current axis to <code class="docutils literal notranslate"><span class="pre">plot_pair</span></code> method by passing the keyword argument <code class="docutils literal notranslate"><span class="pre">ax=plt.gca()</span></code>)</p></li>
<li><p>Does the samples seem to represent the prior distribution correctly?</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">x_1</span></code> and <code class="docutils literal notranslate"><span class="pre">x_2</span></code> of the prior distribution are independent and identically distributed random variables. In this exercise:
a. Define a new Gaussian distribution <code class="docutils literal notranslate"><span class="pre">x_exercise</span></code> where <code class="docutils literal notranslate"><span class="pre">x_1</span></code> and <code class="docutils literal notranslate"><span class="pre">x_2</span></code> are correlated with covariance of 0.7. Set <code class="docutils literal notranslate"><span class="pre">x_1</span></code> variance to 1 and <code class="docutils literal notranslate"><span class="pre">x_2</span></code> variance to 4 for. The covariance matrix is given by:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{bmatrix} 1 &amp; 0.7 \\ 0.7 &amp; 4 \end{bmatrix}\end{split}\]</div>
</li>
<li><p>Visualize the PDF of the new distribution <code class="docutils literal notranslate"><span class="pre">x_exercise</span></code> and the pair plot of the samples from the distribution in one plot. What do you observe?</p></li>
<li><p>Is this true for you: <strong>“I learned how to create a distribution object in CUQIpy that represents the prior, sample it, and visualize it”</strong>? If not, what questions do you have?</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># your code here</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="the-noise-distribution">
<h2><font color=#CD853F> The noise distribution </font> <a class="anchor" id="r-the-noise-distribution"></a><a class="headerlink" href="#the-noise-distribution" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>As mentioned earlier, we assume <span class="math notranslate nohighlight">\(e \sim \mathrm{Gaussain}(0, 0.1)\)</span></p></li>
<li><p>We can define the noise distribution as follows:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="n">Gaussian</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We print the noise distribution object:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CUQI Gaussian.
</pre></div>
</div>
</div>
</div>
<p>We draw some samples from the noise distribution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">samples</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And visualize them. One way to do that is to use the trace plot in <code class="docutils literal notranslate"><span class="pre">CUQIpy</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">samples</span><span class="o">.</span><span class="n">plot_trace</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[&lt;Axes: title={&#39;center&#39;: &#39;v&#39;}&gt;, &lt;Axes: title={&#39;center&#39;: &#39;v&#39;}&gt;]],
      dtype=object)
</pre></div>
</div>
<img alt="../_images/c3998d6a2662328d6b7e2837e8ae35a463cbcf9a386fcc9ab91ba4b905617dc6.png" src="../_images/c3998d6a2662328d6b7e2837e8ae35a463cbcf9a386fcc9ab91ba4b905617dc6.png" />
</div>
</div>
<p>On the left is a kernel density estimation (KDE) of the samples, and on the right is the trace plot of the samples.</p>
<p>Let us also plot the PDF of the noise distribution, using the python function <code class="docutils literal notranslate"><span class="pre">plot_pdf</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_pdf_1D</span><span class="p">(</span><span class="n">distb</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">):</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">distb</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">grid_point</span><span class="p">)</span> <span class="k">for</span> <span class="n">grid_point</span> <span class="ow">in</span> <span class="n">grid</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_pdf_1D</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/673b7834e08d6f61a94c17d516f9d7085f77b4e999ceb7e471d6583422157adb.png" src="../_images/673b7834e08d6f61a94c17d516f9d7085f77b4e999ceb7e471d6583422157adb.png" />
</div>
</div>
<section id="id2">
<h3><font color=#8B4513>Exercise </font><a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Create another noise distribution <code class="docutils literal notranslate"><span class="pre">e_exercise</span></code> with mean 0 and variance 0.5 and plot its PDF</p></li>
<li><p>Plot the PDF of the noise distribution <code class="docutils literal notranslate"><span class="pre">e_exercise</span></code> and the noise distribution <code class="docutils literal notranslate"><span class="pre">e</span></code> on the same plot</p></li>
<li><p>What do you observe?</p></li>
<li><p>Is this true for you: <strong>“I learned how to create a distribution object in CUQIpy that represents the noise level and visualize it”</strong>? If not, what questions do you have?</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># your code here</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="the-data-distribution">
<h2><font color=#CD853F> The data distribution </font> <a class="anchor" id="r-the-data-distribution"></a><a class="headerlink" href="#the-data-distribution" title="Link to this heading">#</a></h2>
<p>The noise in the measurement data follows <span class="math notranslate nohighlight">\(e \sim \mathrm{Gaussain}(0, 0.1)\)</span> and due to the relation <span class="math notranslate nohighlight">\(b = \mathbf{A}\mathbf{x} + e \)</span>, we can write</p>
<div class="math notranslate nohighlight">
\[ b | \mathbf{x} \sim \mathrm{Gaussian}(\mathbf{A}\mathbf{x}, \sigma^2\mathbf{I})\]</div>
<p>and in this case we specify <span class="math notranslate nohighlight">\(\sigma^2 = 0.1\)</span>.</p>
<div class="math notranslate nohighlight">
\[ \pi (b | \mathbf{x}) = \frac{1}{\sqrt{(2 \pi)^m \sigma^{2m}}} \mathrm{exp}\left(-\frac{||\mathbf{A}\mathbf{x}- b||^2}{2\sigma^2}\right) \]</div>
<ul class="simple">
<li><p>The data distribution is the conditional distribution of <span class="math notranslate nohighlight">\(b\)</span> given <span class="math notranslate nohighlight">\(\mathbf{x}\)</span>.</p></li>
<li><p>This PDF can only be evaluated for a given <span class="math notranslate nohighlight">\(\mathbf{x}\)</span>.</p></li>
</ul>
<p>We create the data distribution object as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">Gaussian</span><span class="p">(</span><span class="n">A</span><span class="nd">@x</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We print the data distribution object:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">b</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CUQI Gaussian. Conditioning variables [&#39;x&#39;].
</pre></div>
</div>
</div>
</div>
<p>Note that we can not sample from this distribution directly. If we try, we will get an error:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Here we catch the error and print it</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">b</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cannot sample from conditional distribution. Missing conditioning variables: [&#39;x&#39;]
</pre></div>
</div>
</div>
</div>
<p>Before sampling or evaluating the PDF of <code class="docutils literal notranslate"><span class="pre">b</span></code>, we need to specify the value of the parameters <code class="docutils literal notranslate"><span class="pre">x</span></code>, let us choose the following value:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">particular_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Then we condition the data distribution <code class="docutils literal notranslate"><span class="pre">b</span></code> on the given parameter <code class="docutils literal notranslate"><span class="pre">particular_x</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">b_given_particular_x</span> <span class="o">=</span> <span class="n">b</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">particular_x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we have the distribution object <code class="docutils literal notranslate"><span class="pre">b_given_particular_x</span></code> that represents the data distribution given a particular value of the parameters <code class="docutils literal notranslate"><span class="pre">x</span></code>. We can now plot the PDF of this distribution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_pdf_1D</span><span class="p">(</span><span class="n">b_given_particular_x</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/1b770975d293d77a811a9fabc894397fee873a115f21a656a9f794f4cfd4a32b.png" src="../_images/1b770975d293d77a811a9fabc894397fee873a115f21a656a9f794f4cfd4a32b.png" />
</div>
</div>
<p>We can use <code class="docutils literal notranslate"><span class="pre">b_given_particular_x</span></code> to simulate noisy data assuming that the true <code class="docutils literal notranslate"><span class="pre">x</span></code> parameters is <code class="docutils literal notranslate"><span class="pre">particular_x</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">b_obs</span> <span class="o">=</span> <span class="n">b_given_particular_x</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">b_obs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.6118505104795755
</pre></div>
</div>
</div>
</div>
<section id="id3">
<h3><font color=#8B4513>Exercise </font><a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Print the distribution object <code class="docutils literal notranslate"><span class="pre">b_given_particular_x</span></code>, how does the output differ from printing <code class="docutils literal notranslate"><span class="pre">b</span></code>.</p></li>
<li><p>What is the ratio of the noise in the data (the noise in <code class="docutils literal notranslate"><span class="pre">b_obs</span></code>) to the true data.</p></li>
<li><p>Explain how the data distribution is different from the noise distribution.</p></li>
<li><p>Assume we have a multiplicative noise case in which the level of the noise depends on the model output, i.e., <span class="math notranslate nohighlight">\(b =  (\mathbf{A}\mathbf{x}) e\)</span> where <span class="math notranslate nohighlight">\(e \sim \mathrm{Gaussain}(1, 0.1)\)</span>.</p>
<ul class="simple">
<li><p>What is the corresponding data distribution?</p></li>
<li><p>Define the data distribution in CUQIpy and call it <code class="docutils literal notranslate"><span class="pre">b_mult</span></code>. Plot its PDF (condition on <code class="docutils literal notranslate"><span class="pre">particular_x</span></code>). Tip: you can use lambda function to define the <code class="docutils literal notranslate"><span class="pre">Gaussian</span></code> covariance <code class="docutils literal notranslate"><span class="pre">lambda</span> <span class="pre">x</span> <span class="pre">:</span> <span class="pre">0.1*(A&#64;x)**2</span></code>.</p></li>
<li><p>Plot the PDF of the data distribution <code class="docutils literal notranslate"><span class="pre">b_mult</span></code> given <code class="docutils literal notranslate"><span class="pre">x=particular_x</span></code>.</p></li>
<li><p>In general, for the given <code class="docutils literal notranslate"><span class="pre">x_particular</span></code>, how does the noise to the exact data ratio change in the case of <code class="docutils literal notranslate"><span class="pre">b_mult</span></code> compared to <code class="docutils literal notranslate"><span class="pre">b</span></code>?</p></li>
<li><p>Plot the PDF of the data distribution <code class="docutils literal notranslate"><span class="pre">b_mult</span></code> given a different value of <code class="docutils literal notranslate"><span class="pre">x=np.array([0.4,</span> <span class="pre">0.3])</span></code>. What can we say about the noise ratio to the exact data in this case? and why?</p></li>
</ul>
</li>
<li><p>Is this true for you: <strong>“I learned how to create and design data distributions in CUQIpy and visualize it for a given parameter”</strong>? If not, what questions do you have?</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># your code here</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="the-likelihood-function">
<h2><font color=#CD853F> The likelihood function </font> <a class="anchor" id="r-the-likelihood-function"></a><a class="headerlink" href="#the-likelihood-function" title="Link to this heading">#</a></h2>
<p>Likelihood function: by fixing observed data <span class="math notranslate nohighlight">\(b^\mathrm{obs}\)</span> in the data distribution and considering the function of <span class="math notranslate nohighlight">\(\mathbf{x}\)</span>:</p>
<div class="math notranslate nohighlight">
\[L (\mathbf{x} | b^\mathrm{obs}) \mathrel{\vcenter{:}}= \pi (b^\mathrm{obs} | \mathbf{x})\]</div>
<p>Example, given observed data  <span class="math notranslate nohighlight">\(b^\mathrm{obs} \)</span></p>
<div class="math notranslate nohighlight">
\[L (x_1, x_2 | b=b^\mathrm{obs}) = \frac{1}{\sqrt{2 \pi \cdot 0.1}} \mathrm{exp}\left(-\frac{(x_1+x_2- b^\mathrm{obs})^2}{2\cdot 0.1}\right) \]</div>
<p>In CUQIpy, we can define the likelihood function as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">likelihood</span> <span class="o">=</span> <span class="n">b</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="n">b_obs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">likelihood</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CUQI Gaussian Likelihood function. Parameters [&#39;x&#39;].
</pre></div>
</div>
</div>
</div>
<p>Note that the likelihood function is a density function and is not a distribution. If we try to compute <code class="docutils literal notranslate"><span class="pre">pdf</span></code> for example, we will get an error:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">likelihood</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">particular_x</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Likelihood&#39; object has no attribute &#39;pdf&#39;
</pre></div>
</div>
</div>
</div>
<p>while for example, we can evaluate the pdf for the distribution <code class="docutils literal notranslate"><span class="pre">x</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">particular_x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.02588303])
</pre></div>
</div>
</div>
</div>
<p>For the likelihood function, we can evaluate its log-density:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">likelihood</span><span class="o">.</span><span class="n">logd</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">particular_x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CUQIarray: NumPy array wrapped with geometry.
---------------------------------------------

Geometry:
 _DefaultGeometry1D(1,)

Parameters:
 True

Array:
CUQIarray([-0.52094612])
</pre></div>
</div>
</div>
</div>
<p>We plot the likelihood function for the observed data <code class="docutils literal notranslate"><span class="pre">b_obs</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x1_lim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="n">x2_lim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="n">plot_pdf_2D</span><span class="p">(</span>
    <span class="n">likelihood</span><span class="p">,</span>
    <span class="n">x1_min</span><span class="o">=</span><span class="n">x1_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1_max</span><span class="o">=</span><span class="n">x1_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">x2_min</span><span class="o">=</span><span class="n">x2_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x2_max</span><span class="o">=</span><span class="n">x2_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_1809/403389231.py:23: DeprecationWarning: Conversion of an array with ndim &gt; 0 to a scalar is deprecated, and will error in future. Ensure you extract a single element from your array before performing this operation. (Deprecated NumPy 1.25.)
  distb_pdf[ii,jj] = np.exp(distb.logd([grid1[ii,jj], grid2[ii,jj]]))
</pre></div>
</div>
<img alt="../_images/540b38ac624a3c33f19958814a01fb665a34b5eaadfa4ad95e6d2aac61cd7359.png" src="../_images/540b38ac624a3c33f19958814a01fb665a34b5eaadfa4ad95e6d2aac61cd7359.png" />
</div>
</div>
</section>
<section id="maximum-likelihood-ml-point-estimate">
<h2><font color=#CD853F> Maximum likelihood (ML) point estimate </font> <a class="anchor" id="r-maximum-likelihood-ml-point-estimate"></a><a class="headerlink" href="#maximum-likelihood-ml-point-estimate" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Equivalently, minimizer of negative log of likelihood</p></li>
<li><p>In the case of Gaussian noise is the least-squares solution</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\mathbf{x}^* = \underset{\mathbf{x}}{\operatorname{argmin\;}} \frac{1}{2 \sigma^2} ||\mathbf{A}\mathbf{x}- b^\mathrm{obs}||_2^2\]</div>
<p>We plot likelihood function again but with line <span class="math notranslate nohighlight">\(x_2 = b^{obs}-x_1\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the likelihood</span>
<span class="n">plot_pdf_2D</span><span class="p">(</span>
    <span class="n">likelihood</span><span class="p">,</span>
    <span class="n">x1_min</span><span class="o">=</span><span class="n">x1_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1_max</span><span class="o">=</span><span class="n">x1_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">x2_min</span><span class="o">=</span><span class="n">x2_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x2_max</span><span class="o">=</span><span class="n">x2_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Plot the line x2 = b_obs - x1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1_lim</span><span class="p">,</span> <span class="n">b_obs</span><span class="o">-</span><span class="n">x1_lim</span><span class="p">,</span> <span class="s1">&#39;--r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">x2_lim</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_1809/403389231.py:23: DeprecationWarning: Conversion of an array with ndim &gt; 0 to a scalar is deprecated, and will error in future. Ensure you extract a single element from your array before performing this operation. (Deprecated NumPy 1.25.)
  distb_pdf[ii,jj] = np.exp(distb.logd([grid1[ii,jj], grid2[ii,jj]]))
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(-5.0, 5.0)
</pre></div>
</div>
<img alt="../_images/bf3735b2bfda02c1b9b76ee3691591b8ed0c90ae1e1c20a36279f87681af80c5.png" src="../_images/bf3735b2bfda02c1b9b76ee3691591b8ed0c90ae1e1c20a36279f87681af80c5.png" />
</div>
</div>
<p>Note that:</p>
<ul class="simple">
<li><p>All the points on the line <span class="math notranslate nohighlight">\(x_2 = b^{obs}-x_1\)</span> have the same likelihood value.</p></li>
<li><p>No unique ML point</p></li>
<li><p>This is expected, since problem we are solving is: <span class="math notranslate nohighlight">\(b^{obs} = x_1 + x_2\)</span></p></li>
<li><p>Combining the likelihood with the prior will give us a unique maximum a posteriori (MAP) point estimate as we will see next.</p></li>
</ul>
</section>
<section id="the-posterior-distribution">
<h2><font color=#CD853F> The posterior distribution </font> <a class="anchor" id="r-posterior"></a><a class="headerlink" href="#the-posterior-distribution" title="Link to this heading">#</a></h2>
<section id="bayes-rule">
<h3>Bayes’ rule<a class="headerlink" href="#bayes-rule" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>The posterior is proportional to product of <strong>likelihood</strong> and <strong>prior</strong>
$<span class="math notranslate nohighlight">\(\pi(\mathbf{x} | b) \propto \pi( b|\mathbf{x})\pi(\mathbf{x})\)</span>$</p></li>
<li><p>Note that <span class="math notranslate nohighlight">\(\pi( b|\mathbf{x})\)</span> here denotes the likelihood and not the data distribution, despite often written that way.</p></li>
</ul>
<p>In CUQIpy, we can use the class <code class="docutils literal notranslate"><span class="pre">BayesianProblem</span></code> to bundle the prior, the data distribution, and the data, then use it to explore the posterior distribution (e.g. point estimate and sampling):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">BP</span> <span class="o">=</span> <span class="n">BayesianProblem</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">BP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BayesianProblem with target: 
 JointDistribution(
    Equation: 
	p(b,x) = p(b|x)p(x)
    Densities: 
	b ~ CUQI Gaussian. Conditioning variables [&#39;x&#39;].
	x ~ CUQI Gaussian.
)
</pre></div>
</div>
</div>
</div>
<p>Now we pass the data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">BP</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="n">b_obs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">BP</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BayesianProblem with target: 
 Posterior(
    Equation:
	 p(x|b) ∝ L(x|b)p(x)
    Densities:
	b ~ CUQI Gaussian Likelihood function. Parameters [&#39;x&#39;].
 	x ~ CUQI Gaussian.
 )
</pre></div>
</div>
</div>
</div>
<p>Note the difference in the target of the <code class="docutils literal notranslate"><span class="pre">BayesianProblem</span></code> object before and after passing the data.</p>
</section>
</section>
<section id="maximum-a-posteriori-map-estimate">
<h2><font color=#CD853F> Maximum a posteriori (MAP) estimate </font> <a class="anchor" id="r-maximum-a-posteriori-map-estimate"></a><a class="headerlink" href="#maximum-a-posteriori-map-estimate" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Maximizer of the posterior</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\mathbf{x}^* = \underset{\mathbf{x}}{\operatorname{argmax\;}} \pi(\mathbf{x} | b)\]</div>
<ul class="simple">
<li><p>In the case with Gaussian noise and Gaussian prior, this is the classic Tikhonov solution</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\mathbf{x}^* = \underset{\mathbf{x}}{\operatorname{argmin\;}} \frac{1}{2 \sigma^2} ||\mathbf{A}\mathbf{x}- b^\mathrm{obs}||_2^2 + \frac{1}{2\delta^2}||\mathbf{x} ||^2_2\]</div>
<section id="id4">
<h3><font color=#8B4513>Exercise </font><a class="headerlink" href="#id4" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">BayesianProblem</span></code> object to compute the MAP estimate. Objects of the class <code class="docutils literal notranslate"><span class="pre">BayesianProblem</span></code> have a method <code class="docutils literal notranslate"><span class="pre">MAP</span></code> that computes the MAP estimate.</p></li>
<li><p>Print the solution (the MAP estimate) and compare it to the true solution <code class="docutils literal notranslate"><span class="pre">particular_x</span></code>, what do you observe? If they are different, why?</p></li>
<li><p>Is this true for you: <strong>“I learned how to compute the MAP estimate in CUQIpy”</strong>? If not, what questions do you have?</p></li>
<li><p>Is this true for you: <strong>“In paper and pencil, I can write the minimization problem that corresponds to finding the MAP estimate”</strong>? If not, what questions do you have?</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># your code here</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="sampling-from-the-posterior">
<h2><font color=#CD853F> Sampling from the posterior </font> <a class="anchor" id="r-sampling-from-the-posterior"></a><a class="headerlink" href="#sampling-from-the-posterior" title="Link to this heading">#</a></h2>
<p>The MAP point is a very useful point estimate, but it does not provide information about the uncertainty in the estimate. Thus, we need to sample from the posterior distribution to quantify the uncertainty.</p>
<p>Before sampling from the posterior distribution, let us plot the posterior distribution.</p>
<p><strong>Note</strong> that in this example the posterior distribution is a multivariate distribution of two parameters only and it is easy to evaluate the PDF of the posterior distribution over a grid of points in the parameter space. However, typically, the posterior distribution is high-dimensional and evaluating the PDF over an n-dimensional grid is not feasible.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_pdf_2D</span><span class="p">(</span><span class="n">BP</span><span class="o">.</span><span class="n">posterior</span><span class="p">,</span> <span class="n">x1_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x2_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x2_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_1809/403389231.py:23: DeprecationWarning: Conversion of an array with ndim &gt; 0 to a scalar is deprecated, and will error in future. Ensure you extract a single element from your array before performing this operation. (Deprecated NumPy 1.25.)
  distb_pdf[ii,jj] = np.exp(distb.logd([grid1[ii,jj], grid2[ii,jj]]))
</pre></div>
</div>
<img alt="../_images/7fb7535d5a178ccb940c5774e4955ffe91bb124682fb851b52bf931278b0ab7c.png" src="../_images/7fb7535d5a178ccb940c5774e4955ffe91bb124682fb851b52bf931278b0ab7c.png" />
</div>
</div>
<section id="id5">
<h3><font color=#8B4513>Exercise </font><a class="headerlink" href="#id5" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">BayesianProblem</span></code> object to sample from the posterior distribution. Objects of the class <code class="docutils literal notranslate"><span class="pre">BayesianProblem</span></code> have a method <code class="docutils literal notranslate"><span class="pre">sample_posterior</span></code> that samples from the posterior distribution. You can use <code class="docutils literal notranslate"><span class="pre">help(BP.sample_posterior)</span></code> to see the documentation of the method.</p></li>
<li><p>The method <code class="docutils literal notranslate"><span class="pre">sample_posterior</span></code> returns a <code class="docutils literal notranslate"><span class="pre">Samples</span></code> object, which is the same type of object that is returned by the <code class="docutils literal notranslate"><span class="pre">sample</span></code> method of the <code class="docutils literal notranslate"><span class="pre">Distribution</span></code> class. Visualize the posterior samples using the <code class="docutils literal notranslate"><span class="pre">plot_trace</span></code> method of the <code class="docutils literal notranslate"><span class="pre">Samples</span></code> object.</p></li>
<li><p>Similar to what you did for the prior, plot the pair plot of the posterior samples over the prior PDF (in the same plot). Are the samples consistent with the posterior distribution PDF?</p></li>
<li><p>Is this true for you: <strong>“I learned how to sample from the posterior distribution in CUQIpy and visualize the samples”</strong>? If not, what questions do you have?</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># your code here</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "CUQI-DTU/CUQI-Book",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapter01"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="intro_example_short.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Probably the simplest BIP in the world (the short story)</p>
      </div>
    </a>
    <a class="right-next"
       href="../chapter02/chapter02.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Chapter 2: Problem examples</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#contents-of-this-notebook"><font color="#CD853F"> Contents of this notebook: </font></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-objectives"><font color="#CD853F"> Learning objectives: </font> <a name="r-learning-objectives"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-forward-model"><font color="#CD853F">The forward model </font> <a class="anchor" id="r-the-forward-model"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise"><font color="#8B4513">Exercise </font></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#elaboration-on-geometries"><font color="#8B4513">Elaboration on Geometries </font></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-prior"><font color="#CD853F">The prior </font> <a class="anchor" id="r-the-prior"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bayesian-approach-use-prior-to-express-belief-about-solution">Bayesian approach: Use prior to express belief about solution</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1"><font color="#8B4513">Exercise </font></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-noise-distribution"><font color="#CD853F"> The noise distribution </font> <a class="anchor" id="r-the-noise-distribution"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2"><font color="#8B4513">Exercise </font></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-data-distribution"><font color="#CD853F"> The data distribution </font> <a class="anchor" id="r-the-data-distribution"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3"><font color="#8B4513">Exercise </font></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-likelihood-function"><font color="#CD853F"> The likelihood function </font> <a class="anchor" id="r-the-likelihood-function"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#maximum-likelihood-ml-point-estimate"><font color="#CD853F"> Maximum likelihood (ML) point estimate </font> <a class="anchor" id="r-maximum-likelihood-ml-point-estimate"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-posterior-distribution"><font color="#CD853F"> The posterior distribution </font> <a class="anchor" id="r-posterior"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bayes-rule">Bayes’ rule</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#maximum-a-posteriori-map-estimate"><font color="#CD853F"> Maximum a posteriori (MAP) estimate </font> <a class="anchor" id="r-maximum-a-posteriori-map-estimate"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4"><font color="#8B4513">Exercise </font></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sampling-from-the-posterior"><font color="#CD853F"> Sampling from the posterior </font> <a class="anchor" id="r-sampling-from-the-posterior"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5"><font color="#8B4513">Exercise </font></a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By CUQIpy developer team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <p>
<a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank">Apache 2.0 License</a>
</p>
</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>